<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/stylesheets/index.css">
  <title>View Memories - MEMO TRACK</title>
</head>
<body>
  <h2 style="text-align:center;">Your Memories</h2>
  <div style="max-width:900px;margin:1rem auto;">
    <% const mems = (user.memories || []); %>
    <% if (mems.length === 0) { %>
      <p style="text-align:center;">No memories yet. <a href="/add-memory">Add one</a>.</p>
    <% } else { %>
      <ul style="list-style:none;padding:0;">
        <% mems.slice().reverse().forEach(m => { %>
          <li style="background:#fff;padding:12px;margin:8px 0;border-radius:6px;">
            <h4><%= m.title %></h4>
            <p><%= m.notes %></p>
            <small><%= new Date(m.timestamp).toLocaleString() %></small>
            <form action="/delete-memory" method="post" style="display:inline;margin-left:12px;">
              <input type="hidden" name="id" value="<%= m.id %>" />
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>
  <% if (typeof favorites !== 'undefined' && Array.isArray(favorites) && favorites.length > 0) { %>
    <div style="max-width:900px;margin:1rem auto;padding:1rem;background:#fff;">
      <h3>Favorites from your caretakers</h3>
      <ul style="list-style:none;padding:0;">
        <% favorites.forEach(f => { %>
          <li style="margin:8px 0;padding:8px;background:#f9f9f9;border-radius:6px;">
            <strong><%= f.title %></strong>
            <div style="margin-top:6px;">
              <!-- If URL is a direct audio file, use audio tag; otherwise show link -->
              <% if (f.url && (f.url.endsWith('.mp3') || f.url.endsWith('.wav') || f.url.indexOf('audio') !== -1)) { %>
                <audio controls src="<%= f.url %>"></audio>
              <% } else { %>
                <a href="<%= f.url %>" target="_blank">Open link</a>
              <% } %>
            </div>
          </li>
        <% }) %>
      </ul>
    </div>
  <% } %>
</body>
</html>